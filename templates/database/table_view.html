{% extends "base.html" %}
{% load db_filters %}

{% block title %}{{ model_name|title|replace:"_| " }} • Database • EmailIQ{% endblock %}

{% block header_title %}{{ model_name|title|replace:"_| " }}{% endblock %}

{% block content %}
<div class="bg-gray-800">
  <div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
    {% include 'includes/page_header.html' with title=model_name|title|replace:"_| " %}
  </div>
</div>
<section class="bg-gray-800 rounded-lg border border-white/10 overflow-hidden mt-6">
  <ul role="list" class="divide-y divide-white/5">
    {% for obj in page_obj %}
    <li class="flex justify-between gap-x-6 py-5 px-6 hover:bg-white/5 transition-colors cursor-pointer" onclick="window.location.href='{% url 'database_row_detail' model_name obj.pk %}'">
      <div class="flex min-w-0 gap-x-4 flex-1">
        <div class="size-12 flex-none rounded-full bg-gray-700 outline -outline-offset-1 outline-white/10 flex items-center justify-center">
          <span class="text-xs font-mono text-gray-400">ID</span>
        </div>
        <div class="min-w-0 flex-auto">
          <p class="text-sm/6 font-semibold text-white">Row #{{ obj.pk }}</p>
          <p class="mt-1 truncate text-xs/5 text-gray-400">
            {% for field in fields|slice_filter:"|3" %}
              {% with value=obj|getattr_filter:field %}
                {% if value %}
                  {% if value|length > 30 %}
                    {{ value|slice_filter:"|30" }}...
                  {% else %}
                    {{ value }}
                  {% endif %}
                  {% if not forloop.last %} • {% endif %}
                {% endif %}
              {% endwith %}
            {% endfor %}
          </p>
        </div>
      </div>
      <div class="hidden shrink-0 sm:flex sm:flex-col sm:items-end sm:gap-2">
        <div class="flex items-center gap-2">
          <div onclick="event.stopPropagation();">
            {% url 'database_row_detail' model_name obj.pk as row_detail_url %}
            {% url 'database_row_delete' model_name obj.pk as row_delete_url %}
            {% include 'includes/action_dropdown.html' with view_url=row_detail_url delete_url=row_delete_url delete_message="Are you sure you want to delete this row?" %}
          </div>
        </div>
      </div>
    </li>
    {% empty %}
    <li class="px-6 py-16 text-center bg-gray-100">
      <p class="text-gray-400 text-base">No rows found in this table.</p>
    </li>
    {% endfor %}
  </ul>
  
  {% if page_obj.has_other_pages %}
  <div class="px-6 py-4 border-t border-white/5 flex items-center justify-between">
    <div class="text-sm text-gray-400">
      Showing {{ page_obj.start_index }} to {{ page_obj.end_index }} of {{ total_count }} rows
    </div>
    <div class="flex gap-2">
      {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}" class="px-4 py-2 bg-white/10 text-white rounded-md hover:bg-white/20 text-sm font-semibold">
        Previous
      </a>
      {% endif %}
      {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}" class="px-4 py-2 bg-cyan-600 text-white rounded-md hover:bg-cyan-500 text-sm font-semibold">
        Next
      </a>
      {% endif %}
    </div>
  </div>
  {% endif %}
</section>
{% endblock %}
