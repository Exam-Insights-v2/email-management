{% comment %}
List row component for tasks - reusable across priority sections
{% endcomment %}
<li class="grid grid-cols-[32px_1fr_24px_auto_32px] sm:grid-cols-[40px_60px_24px_1fr_auto_120px_32px] gap-2 sm:gap-4 items-center py-2 sm:py-2.5 px-3 sm:px-4 hover:bg-gray-50 dark:hover:bg-white/5 transition-colors cursor-pointer task-row" data-task-pk="{{ task.pk }}">
  <!-- Priority Bars Column -->
  <div class="flex items-center justify-center">
    <div class="flex items-end gap-0.5 h-4">
      {% include 'tasks/priority_bars.html' with priority=task.priority %}
    </div>
  </div>
  
  <!-- Mobile Layout: Title and ID together -->
  <div class="flex items-center min-w-0 sm:hidden">
    <div class="flex-1 min-w-0">
      <p class="text-xs font-normal text-gray-700 dark:text-gray-100 truncate">{{ task.title|default:"Untitled Task" }}</p>
      <div class="flex items-center gap-1.5 mt-0.5">
        <span class="text-xs font-light text-gray-500 dark:text-gray-400">TASK-{{ task.account_task_number|default:task.pk }}</span>
        <span class="text-xs text-gray-500 dark:text-gray-400">â€¢</span>
        {% load db_filters %}
        <time datetime="{% if task.email_message and task.email_message.date_sent %}{{ task.email_message.date_sent|date:'Y-m-d' }}{% else %}{{ task.created_at|date:'Y-m-d' }}{% endif %}" class="text-xs text-gray-500 dark:text-gray-400">{% if task.email_message and task.email_message.date_sent %}{{ task.email_message.date_sent|aus_time:"d M g:i A" }}{% else %}{{ task.created_at|aus_time:"d M g:i A" }}{% endif %}</time>
      </div>
    </div>
  </div>
  
  <!-- Mark as Done Button Column (Mobile) -->
  {% if task.status != 'done' %}
  <div class="flex items-center justify-center sm:hidden">
    <form method="post" action="{% url 'task_update' task.pk %}" class="inline" onsubmit="event.stopPropagation(); return true;">
      {% csrf_token %}
      <input type="hidden" name="next" value="{{ request.get_full_path }}">
      <input type="hidden" name="title" value="{{ task.title|default:'' }}">
      <input type="hidden" name="description" value="{{ task.description|default:'' }}">
      <input type="hidden" name="priority" value="{{ task.priority|default:1 }}">
      <input type="hidden" name="status" value="done">
      {% if task.due_at %}
      {% load db_filters %}
      <input type="hidden" name="due_at" value="{{ task.due_at|date:'Y-m-d' }}T{{ task.due_at|time:'H:i' }}">
      {% endif %}
      <button type="submit" onclick="event.stopPropagation();" class="flex items-center justify-center rounded-md p-1.5 text-gray-400 hover:text-emerald-600 dark:hover:text-emerald-400 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-colors focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-600" aria-label="Mark as Done" title="Mark as Done">
        <span class="material-icons size-4" aria-hidden="true">check_circle</span>
      </button>
    </form>
  </div>
  {% else %}
  <div class="flex items-center justify-center sm:hidden">
    <form method="post" action="{% url 'task_update' task.pk %}" class="inline" onsubmit="event.stopPropagation(); return true;">
      {% csrf_token %}
      <input type="hidden" name="next" value="{{ request.get_full_path }}">
      <input type="hidden" name="title" value="{{ task.title|default:'' }}">
      <input type="hidden" name="description" value="{{ task.description|default:'' }}">
      <input type="hidden" name="priority" value="{{ task.priority|default:1 }}">
      <input type="hidden" name="status" value="pending">
      {% if task.due_at %}
      {% load db_filters %}
      <input type="hidden" name="due_at" value="{{ task.due_at|date:'Y-m-d' }}T{{ task.due_at|time:'H:i' }}">
      {% endif %}
      <button type="submit" onclick="event.stopPropagation();" class="flex items-center justify-center rounded-md p-1.5 text-emerald-600 dark:text-emerald-400 hover:bg-amber-50 dark:hover:bg-amber-900/20 transition-colors focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-amber-600" aria-label="Undone" title="Undone">
        <span class="material-icons size-4" aria-hidden="true">radio_button_unchecked</span>
      </button>
    </form>
  </div>
  {% endif %}
  
  <!-- Desktop Layout -->
  <!-- ID Column (Desktop) -->
  <div class="hidden sm:flex items-center">
    <span class="text-xs font-light text-gray-500 dark:text-gray-200">TASK-{{ task.account_task_number|default:task.pk }}</span>
  </div>
  
  <!-- Status/Progress Icon Column -->
  <div class="flex items-center justify-center">
    {% if task.status == 'done' %}
      <span class="material-icons size-4 text-green-500 dark:text-green-400" aria-hidden="true" title="Done">check_circle</span>
    {% elif task.status == 'in_progress' %}
      <span class="material-icons size-4 text-blue-500 dark:text-blue-400" aria-hidden="true" title="In Progress">play_circle</span>
    {% elif task.status == 'cancelled' %}
      <span class="material-icons size-4 text-red-500 dark:text-red-400" aria-hidden="true" title="Cancelled">cancel</span>
    {% else %}
      <span class="material-icons size-4 text-yellow-500 dark:text-yellow-400" aria-hidden="true" title="Pending">schedule</span>
    {% endif %}
  </div>
  
  <!-- Name Column (Desktop) -->
  <div class="hidden sm:flex items-center min-w-0">
    <p class="text-xs font-normal text-gray-700 dark:text-gray-100 truncate">{{ task.title|default:"Untitled Task" }}</p>
  </div>
  
  <!-- Labels Column (Desktop) -->
  <div class="hidden sm:flex items-center gap-1.5 flex-wrap justify-end">
    {% if task.email_message and task.email_message.labels.all %}
      {% load db_filters %}
      {% for email_label in task.email_message.labels.all %}
        <span class="inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium {{ email_label.label.name|label_color_bg }}">
          <span class="w-1.5 h-1.5 rounded-full {{ email_label.label.name|label_color_dot }}"></span>
          <span class="hidden lg:inline">{{ email_label.label.name }}</span>
        </span>
      {% endfor %}
    {% endif %}
  </div>
  
  <!-- Date Added Column (Desktop) -->
  <div class="hidden sm:flex items-center gap-1.5 text-xs text-gray-500 dark:text-gray-400 justify-end">
    <span class="material-icons size-3" aria-hidden="true">calendar_today</span>
    {% load db_filters %}
    <time datetime="{% if task.email_message and task.email_message.date_sent %}{{ task.email_message.date_sent|date:'Y-m-d' }}{% else %}{{ task.created_at|date:'Y-m-d' }}{% endif %}">{% if task.email_message and task.email_message.date_sent %}{{ task.email_message.date_sent|aus_time:"d M g:i A" }}{% else %}{{ task.created_at|aus_time:"d M g:i A" }}{% endif %}</time>
  </div>
  
  <!-- Mark as Done Button Column (Desktop) -->
  {% if task.status != 'done' %}
  <div class="hidden sm:flex items-center justify-center">
    <form method="post" action="{% url 'task_update' task.pk %}" class="inline" onsubmit="event.stopPropagation(); return true;">
      {% csrf_token %}
      <input type="hidden" name="next" value="{{ request.get_full_path }}">
      <input type="hidden" name="title" value="{{ task.title|default:'' }}">
      <input type="hidden" name="description" value="{{ task.description|default:'' }}">
      <input type="hidden" name="priority" value="{{ task.priority|default:1 }}">
      <input type="hidden" name="status" value="done">
      {% if task.due_at %}
      {% load db_filters %}
      <input type="hidden" name="due_at" value="{{ task.due_at|date:'Y-m-d' }}T{{ task.due_at|time:'H:i' }}">
      {% endif %}
      <button type="submit" onclick="event.stopPropagation();" class="flex items-center justify-center rounded-md p-1.5 text-gray-400 hover:text-emerald-600 dark:hover:text-emerald-400 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-colors focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-600" aria-label="Mark as Done" title="Mark as Done">
        <span class="material-icons size-4 sm:size-5" aria-hidden="true">check_circle</span>
      </button>
    </form>
  </div>
  {% else %}
  <div class="hidden sm:flex items-center justify-center">
    <form method="post" action="{% url 'task_update' task.pk %}" class="inline" onsubmit="event.stopPropagation(); return true;">
      {% csrf_token %}
      <input type="hidden" name="next" value="{{ request.get_full_path }}">
      <input type="hidden" name="title" value="{{ task.title|default:'' }}">
      <input type="hidden" name="description" value="{{ task.description|default:'' }}">
      <input type="hidden" name="priority" value="{{ task.priority|default:1 }}">
      <input type="hidden" name="status" value="pending">
      {% if task.due_at %}
      {% load db_filters %}
      <input type="hidden" name="due_at" value="{{ task.due_at|date:'Y-m-d' }}T{{ task.due_at|time:'H:i' }}">
      {% endif %}
      <button type="submit" onclick="event.stopPropagation();" class="flex items-center justify-center rounded-md p-1.5 text-emerald-600 dark:text-emerald-400 hover:bg-amber-50 dark:hover:bg-amber-900/20 transition-colors focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-amber-600" aria-label="Undone" title="Undone">
        <span class="material-icons size-4 sm:size-5" aria-hidden="true">radio_button_unchecked</span>
      </button>
    </form>
  </div>
  {% endif %}
</li>
