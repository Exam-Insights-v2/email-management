<form method="post" action="{% if object_pk %}{% url form_url object_pk %}?modal=true{% else %}{% url form_url %}{% endif %}">
  {% csrf_token %}
  {% for field in form %}{% if field.is_hidden %}{{ field }}{% endif %}{% endfor %}

  {% if form.non_field_errors %}
  <div class="mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-sm text-red-600 dark:text-red-400" role="alert">
    {{ form.non_field_errors }}
  </div>
  {% endif %}

  <div class="space-y-6">
    <section class="rounded-xl border border-gray-200 dark:border-white/10 bg-white dark:bg-gray-800/50 overflow-hidden">
      <div class="px-4 py-3 border-b border-gray-100 dark:border-white/10 bg-gray-50 dark:bg-gray-800/50">
        <h3 class="text-sm font-medium text-gray-800 dark:text-gray-200 flex items-center gap-2">
          <span class="material-icons size-4 text-gray-500 dark:text-gray-400" aria-hidden="true">label</span>
          Label info
        </h3>
      </div>
      <div class="p-4 space-y-4">
        {% for field in form %}
          {% if not field.is_hidden and field.name in "account,accounts,name,prompt,instructions" %}
            <div class="modal-form-field">
              <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                {{ field.label }}
                {% if field.field.required %}<span class="text-red-400" aria-hidden="true">*</span>{% endif %}
              </label>
              <div class="mt-1 field-control [&_input]:block [&_input]:w-full [&_input]:rounded-lg [&_input]:bg-gray-100 [&_input]:dark:bg-white/5 [&_input]:px-3 [&_input]:py-2 [&_input]:text-sm [&_textarea]:block [&_textarea]:w-full [&_textarea]:rounded-lg [&_textarea]:bg-gray-100 [&_textarea]:dark:bg-white/5 [&_textarea]:px-3 [&_textarea]:py-2 [&_textarea]:text-sm [&_textarea]:min-h-[80px] [&_select]:block [&_select]:w-full [&_select]:rounded-lg [&_select]:bg-gray-100 [&_select]:dark:bg-white/5 [&_select]:px-3 [&_select]:py-2 [&_select]:text-sm [&_select]:border-0 [&_select]:focus:ring-2 [&_select]:focus:ring-cyan-500">
                {{ field }}
              </div>
              {% if field.help_text %}<p class="mt-1.5 text-xs text-gray-500 dark:text-gray-400">{{ field.help_text }}</p>{% endif %}
              {% if field.errors %}<p class="mt-1 text-xs text-red-500 dark:text-red-400" role="alert">{{ field.errors.0 }}</p>{% endif %}
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </section>

    <section class="rounded-xl border border-gray-200 dark:border-white/10 bg-white dark:bg-gray-800/50 overflow-hidden">
      <div class="px-4 py-3 border-b border-gray-100 dark:border-white/10 bg-gray-50 dark:bg-gray-800/50">
        <h3 class="text-sm font-medium text-gray-800 dark:text-gray-200 flex items-center gap-2">
          <span class="material-icons size-4 text-gray-500 dark:text-gray-400" aria-hidden="true">tune</span>
          Options
        </h3>
      </div>
      <div class="p-4 space-y-4">
        {% for field in form %}
          {% if not field.is_hidden and field.name in "priority,is_active,actions" %}
            <div class="modal-form-field">
              <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                {{ field.label }}
                {% if field.field.required %}<span class="text-red-400" aria-hidden="true">*</span>{% endif %}
              </label>
              <div class="mt-1 field-control [&_input]:block [&_input]:w-full [&_input]:rounded-lg [&_input]:bg-gray-100 [&_input]:dark:bg-white/5 [&_input]:px-3 [&_input]:py-2 [&_input]:text-sm [&_select]:block [&_select]:w-full [&_select]:rounded-lg [&_select]:bg-gray-100 [&_select]:dark:bg-white/5 [&_select]:px-3 [&_select]:py-2 [&_select]:text-sm [&_select]:border-0 [&_select]:focus:ring-2 [&_select]:focus:ring-cyan-500 [&_.form-check-input]:rounded [&_.form-check-input]:text-cyan-600">
                {{ field }}
              </div>
              {% if field.help_text %}<p class="mt-1.5 text-xs text-gray-500 dark:text-gray-400">{{ field.help_text }}</p>{% endif %}
              {% if field.errors %}<p class="mt-1 text-xs text-red-500 dark:text-red-400" role="alert">{{ field.errors.0 }}</p>{% endif %}
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </section>
  </div>

  <div class="flex items-center justify-end gap-3 pt-6 mt-6 -mx-4 sm:-mx-5 px-4 sm:px-5 py-4 border-t border-gray-200 dark:border-white/10 bg-gray-100/80 dark:bg-gray-800/50 rounded-b-lg">
    <button type="button" command="close" commandfor="{% if modal_id %}{{ modal_id }}{% else %}{{ drawer_id }}{% endif %}" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors">Cancel</button>
    <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-cyan-600 hover:bg-cyan-500 rounded-lg focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-600 transition-colors">Save</button>
  </div>
</form>

<script>
  (function() {
    const form = document.currentScript.closest('form');
    if (form) {
      form.querySelectorAll('.select-wrapper select').forEach(select => {
        select.classList.add('col-start-1', 'row-start-1', 'block', 'w-full', 'rounded-lg', 'bg-gray-100', 'dark:bg-white/5', 'px-3', 'py-2', 'text-sm', 'text-gray-900', 'dark:text-white', 'border-0', 'focus:ring-2', 'focus:ring-cyan-500', 'appearance-none');
      });
    }
  })();
</script>
