{% extends "base.html" %}

{% block title %}Actions | Email IQ{% endblock %}

{% block header_title %}All Actions{% endblock %}

{% block header_action %}
  {% include 'includes/create_modal.html' with modal_id="create-action" title="Create" form_template="actions/form_content.html" form_url="action_create" button_text="Create New Action" form=form %}
{% endblock %}

{% block content %}

<section class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-white/10 overflow-hidden mt-3">
  <ul role="list" class="divide-y divide-white/5">
    {% for action in actions %}
    <li class="flex justify-between gap-x-4 py-2.5 px-4 hover:bg-white/5 transition-colors cursor-pointer" onclick="if (window.openActionDetailModal) window.openActionDetailModal({{ action.pk }});">
      <div class="flex min-w-0 gap-x-3 flex-1">
        <div class="size-8 flex-none rounded-full bg-gray-100 dark:bg-gray-700 outline -outline-offset-1 outline-gray-200 dark:outline-white/10 flex items-center justify-center">
          <i class="ti ti-bulb size-4 text-gray-600 dark:text-gray-400" aria-hidden="true"></i>
        </div>
        <div class="min-w-0 flex-auto">
          <p class="text-xs font-semibold text-gray-900 dark:text-white">{{ action.name }}</p>
          <p class="truncate text-xs text-gray-600 dark:text-gray-400">
            {% if action.instructions %}{{ action.instructions|truncatewords:20 }}{% else %}{{ action.function }} | {{ action.account.email }}{% endif %}
          </p>
        </div>
      </div>
      <div class="hidden shrink-0 sm:flex sm:flex-col sm:items-end sm:gap-1.5">
        <div class="flex items-center gap-1.5">
          <div onclick="event.stopPropagation();">
            {% url 'action_update' action.pk as action_update_url %}
            {% url 'action_delete' action.pk as action_delete_url %}
            {% include 'includes/action_dropdown.html' with view_onclick="if (window.openActionDetailModal) window.openActionDetailModal({{ action.pk }});" edit_url=action_update_url delete_url=action_delete_url delete_message="Are you sure you want to delete this action?" %}
          </div>
        </div>
        <p class="mt-0.5 text-xs text-gray-600 dark:text-gray-400">
          Created <time datetime="{{ action.created_at|date:'Y-m-d' }}">{{ action.created_at|date:"d M Y" }}</time>
        </p>
      </div>
    </li>
    {% include 'actions/detail_modal.html' with action=action labels=action.labels.all %}
    {% empty %}
    <li class="px-4 py-12 text-center">
      <p class="text-gray-600 dark:text-gray-400 text-sm my-4">No actions yet.</p>
    </li>
    {% endfor %}
  </ul>
</section>

<script>
  // Global function to open action detail modal
  window.openActionDetailModal = function(actionPk) {
    const modalId = 'action-detail-' + actionPk;
    const modal = document.getElementById(modalId);
    if (!modal) {
      console.error('Action detail modal not found:', modalId);
      return;
    }
    modal.showModal();
  };
</script>
{% endblock %}
