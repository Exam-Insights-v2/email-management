{% extends "base.html" %}
{% load static %}

{% block title %}Jobs â€¢ EmailIQ{% endblock %}

{% block header_title %}Jobs{% endblock %}

{% block header_action %}
  {% include 'includes/create_drawer.html' with drawer_id="create-job" title="Create Job" form_template="jobs/form_content.html" form_url="job_create" button_text="Create New Job" form=form %}
{% endblock %}

{% block content %}

<div class="mt-3">
  <!-- Week Navigation -->
  <div class="mb-3 flex items-center justify-between">
    <div class="flex items-center gap-4">
      <a href="?week_start={{ prev_week_start|date:'Y-m-d' }}{% if search_query %}&search={{ search_query|urlencode }}{% endif %}" class="inline-flex items-center justify-center rounded-md p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-600 transition-colors" aria-label="Previous week">
        <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
          <path fill-rule="evenodd" d="M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" />
        </svg>
      </a>
      <div class="text-center">
        <h2 class="text-sm font-semibold text-gray-900 dark:text-white">
          {{ week_start|date:"d M" }} - {{ week_end|date:"d M Y" }}
        </h2>
      </div>
      <a href="?week_start={{ next_week_start|date:'Y-m-d' }}{% if search_query %}&search={{ search_query|urlencode }}{% endif %}" class="inline-flex items-center justify-center rounded-md p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-600 transition-colors" aria-label="Next week">
        <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
          <path fill-rule="evenodd" d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
        </svg>
      </a>
    </div>
    <div class="flex items-center gap-4">
      <!-- View Toggle -->
      <div class="inline-flex rounded-md border border-gray-300 dark:border-white/10 bg-white dark:bg-gray-800 p-1" role="group">
        <button 
          type="button" 
          id="view-toggle-horizontal"
          onclick="toggleCalendarView('horizontal')"
          class="inline-flex items-center rounded px-2 py-1 text-xs font-medium transition-colors view-active:bg-cyan-600 view-active:text-white view-inactive:text-gray-700 view-inactive:dark:text-gray-300 view-inactive:hover:bg-gray-50 view-inactive:dark:hover:bg-white/5"
          aria-label="Horizontal view"
        >
          <svg class="size-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
          List
        </button>
        <button 
          type="button" 
          id="view-toggle-vertical"
          onclick="toggleCalendarView('vertical')"
          class="inline-flex items-center rounded px-2 py-1 text-xs font-medium transition-colors view-active:bg-cyan-600 view-active:text-white view-inactive:text-gray-700 view-inactive:dark:text-gray-300 view-inactive:hover:bg-gray-50 view-inactive:dark:hover:bg-white/5"
          aria-label="Vertical view"
        >
          <svg class="size-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          Week
        </button>
      </div>
      <a href="?week_start={{ current_week_start|date:'Y-m-d' }}{% if search_query %}&search={{ search_query|urlencode }}{% endif %}" class="inline-flex items-center rounded-md bg-cyan-600 px-2 py-1 text-xs font-semibold text-white hover:bg-cyan-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-600">
        <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="mr-1 -ml-0.5 size-3">
          <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm.75-13a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5Z" clip-rule="evenodd" />
        </svg>
        This Week
      </a>
    </div>
  </div>

  <!-- Unscheduled Jobs Section -->
  {% if unscheduled_jobs %}
  <div class="mb-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-white/10 overflow-hidden">
    <div class="px-4 py-2 border-b border-gray-200 dark:border-white/10 bg-amber-50 dark:bg-amber-900/20">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <svg class="size-4 text-amber-600 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <div>
            <h3 class="text-sm font-semibold text-gray-900 dark:text-white">Unscheduled Jobs</h3>
            <p class="mt-0.5 text-xs text-gray-600 dark:text-gray-400">
              {{ unscheduled_jobs|length }} job{{ unscheduled_jobs|length|pluralize }} without scheduled dates
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="divide-y divide-gray-200 dark:divide-white/5">
      {% for job in unscheduled_jobs %}
      <div class="flex justify-between gap-x-4 py-2.5 px-4 hover:bg-gray-50 dark:hover:bg-white/5 transition-colors cursor-pointer" onclick="window.location.href='{% url 'job_detail' job.pk %}'">
        <div class="flex min-w-0 gap-x-3 flex-1">
          <div class="size-8 flex-none rounded-full bg-gray-100 dark:bg-gray-700 outline -outline-offset-1 outline-gray-200 dark:outline-white/10 flex items-center justify-center">
            <svg class="size-4 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
          </div>
          <div class="min-w-0 flex-auto">
            <p class="text-xs font-semibold text-gray-900 dark:text-white">{{ job.title }}</p>
            <p class="mt-0.5 truncate text-xs text-gray-600 dark:text-gray-400">
              {% if job.site_address %}{{ job.site_address }}{% elif job.customer_name %}{{ job.customer_name|join:", " }}{% elif job.description %}{{ job.description|truncatewords:15 }}{% else %}No details{% endif %}
            </p>
          </div>
        </div>
        <div class="hidden shrink-0 sm:flex sm:flex-col sm:items-end sm:gap-1.5">
          <div class="flex items-center gap-1.5">
            <span class="inline-flex items-center rounded-md bg-cyan-400/10 px-1.5 py-0.5 text-xs font-medium text-cyan-400 ring-1 ring-inset ring-cyan-400/30">
              {{ job.get_status_display }}
            </span>
            <div onclick="event.stopPropagation();">
              {% url 'job_detail' job.pk as job_detail_url %}
              {% url 'job_update' job.pk as job_update_url %}
              {% url 'job_delete' job.pk as job_delete_url %}
              {% include 'includes/action_dropdown.html' with view_url=job_detail_url edit_url=job_update_url delete_url=job_delete_url delete_message="Are you sure you want to delete this job?" %}
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Horizontal List View -->
  <div id="calendar-horizontal-view" class="calendar-view space-y-2">
    {% for date_info in calendar_dates %}
    <div 
      id="date-{{ date_info.date_str }}" 
      class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-white/10 overflow-hidden {% if date_info.is_today %}ring-2 ring-cyan-500{% endif %}"
    >
      <!-- Date Header -->
      <div class="px-4 py-2 border-b border-gray-200 dark:border-white/10 bg-cyan-50 dark:bg-cyan-900/20">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div>
              <h3 class="text-sm font-semibold text-cyan-600 dark:text-white">
                {{ date_info.date|date:"l" }}, {{ date_info.date|date:"d M Y" }}
              </h3>
              <p class="mt-0.5 text-xs text-gray-600 dark:text-gray-400">
                {% if date_info.is_today %}Today{% elif date_info.is_past %}Past{% else %}Upcoming{% endif %}
              </p>
            </div>
            {% if date_info.is_today %}
            <span class="inline-flex items-center rounded-md bg-cyan-500/10 px-1.5 py-0.5 text-xs font-medium text-cyan-400 ring-1 ring-inset ring-cyan-500/20">
              Today
            </span>
            {% endif %}
          </div>
          <div class="flex items-center gap-1.5">
            <span class="text-xs text-gray-600 dark:text-gray-400">
              {{ date_info.jobs|length }} job{{ date_info.jobs|length|pluralize }}
            </span>
            <button 
              onclick="openCreateJobDrawer('{{ date_info.date_str }}')" 
              class="inline-flex items-center rounded-md bg-cyan-600 px-2 py-1 text-xs font-semibold text-white hover:bg-cyan-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-600"
            >
              <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="mr-0.5 size-3">
                <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" clip-rule="evenodd" fill-rule="evenodd" />
              </svg>
              Add Job
            </button>
          </div>
        </div>
      </div>

      <!-- Jobs List -->
      <div class="divide-y divide-gray-200 dark:divide-white/5">
        {% if date_info.jobs %}
          {% for job in date_info.jobs %}
          <div class="flex justify-between gap-x-4 py-2.5 px-4 hover:bg-gray-50 dark:hover:bg-white/5 transition-colors cursor-pointer" onclick="window.location.href='{% url 'job_detail' job.pk %}'">
            <div class="flex min-w-0 gap-x-3 flex-1">
              <div class="size-8 flex-none rounded-full bg-gray-100 dark:bg-gray-700 outline -outline-offset-1 outline-gray-200 dark:outline-white/10 flex items-center justify-center">
                <svg class="size-4 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
              </div>
              <div class="min-w-0 flex-auto">
                <p class="text-xs font-semibold text-gray-900 dark:text-white">{{ job.title }}</p>
                <p class="mt-0.5 truncate text-xs text-gray-600 dark:text-gray-400">
                  {% if job.site_address %}{{ job.site_address }}{% elif job.customer_name %}{{ job.customer_name|join:", " }}{% elif job.description %}{{ job.description|truncatewords:15 }}{% else %}No details{% endif %}
                </p>
              </div>
            </div>
            <div class="hidden shrink-0 sm:flex sm:flex-col sm:items-end sm:gap-1.5">
              <div class="flex items-center gap-1.5">
                <span class="inline-flex items-center rounded-md bg-cyan-400/10 px-1.5 py-0.5 text-xs font-medium text-cyan-400 ring-1 ring-inset ring-cyan-400/30">
                  {{ job.get_status_display }}
                </span>
                <div onclick="event.stopPropagation();">
                  {% url 'job_detail' job.pk as job_detail_url %}
                  {% url 'job_update' job.pk as job_update_url %}
                  {% url 'job_delete' job.pk as job_delete_url %}
                  {% include 'includes/action_dropdown.html' with view_url=job_detail_url edit_url=job_update_url delete_url=job_delete_url delete_message="Are you sure you want to delete this job?" %}
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        {% else %}
          <div class="px-4 py-8 text-center">
            <div class="inline-flex items-center justify-center w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-lg mb-2">
              <svg width="20" height="20" class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
            </div>
            <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">No jobs scheduled for this day</p>
            <button 
              onclick="openCreateJobDrawer('{{ date_info.date_str }}')" 
              class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-cyan-600 text-white rounded-md font-semibold hover:bg-cyan-500 transition-colors text-xs"
            >
              <svg width="14" height="14" class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
              </svg>
              Add Job for This Day
            </button>
          </div>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Weekly Vertical View -->
  <div id="calendar-vertical-view" class="calendar-view hidden">
    <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-white/10 overflow-hidden">
      <!-- Week Header -->
      <div class="grid grid-cols-8 border-b border-gray-200 dark:border-white/10">
        <div class="px-3 py-2 border-r border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-gray-900/50"></div>
        {% for date_info in calendar_dates %}
        <div class="px-2 py-2 text-center border-r border-gray-200 dark:border-white/10 last:border-r-0 {% if date_info.is_today %}bg-cyan-50 dark:bg-cyan-900/20{% elif date_info.is_past %}bg-gray-50 dark:bg-gray-900/50{% endif %}">
          <div class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">{{ date_info.date|date:"D" }}</div>
          <div class="mt-0.5 text-sm font-semibold {% if date_info.is_today %}text-cyan-600 dark:text-cyan-400{% else %}text-gray-900 dark:text-white{% endif %}">
            {{ date_info.date|date:"d" }}
          </div>
          {% if date_info.is_today %}
          <div class="mt-0.5">
            <span class="inline-flex items-center rounded-md bg-cyan-500/10 px-1 py-0.5 text-xs font-medium text-cyan-400 ring-1 ring-inset ring-cyan-500/20">Today</span>
          </div>
          {% endif %}
        </div>
        {% endfor %}
      </div>

      <!-- All Day Section -->
      <div class="grid grid-cols-8 border-b border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-gray-900/50">
        <div class="px-3 py-1.5 border-r border-gray-200 dark:border-white/10 text-xs font-medium text-gray-500 dark:text-gray-400">All Day</div>
        {% for date_info in calendar_dates %}
        <div class="px-1.5 py-1.5 border-r border-gray-200 dark:border-white/10 last:border-r-0 min-h-[50px]">
          {% if date_info.jobs %}
            {% for job in date_info.jobs %}
            <div 
              class="mb-0.5 px-1.5 py-1 rounded-md bg-cyan-100 dark:bg-cyan-900/30 border border-cyan-200 dark:border-cyan-800 hover:bg-cyan-200 dark:hover:bg-cyan-900/50 cursor-pointer transition-colors text-xs"
              onclick="window.location.href='{% url 'job_detail' job.pk %}'"
            >
              <div class="font-semibold text-cyan-900 dark:text-cyan-100 truncate text-xs">{{ job.title }}</div>
              {% if job.site_address or job.customer_name %}
              <div class="text-cyan-700 dark:text-cyan-300 truncate mt-0.5 text-xs">
                {% if job.site_address %}{{ job.site_address|truncatewords:2 }}{% elif job.customer_name %}{{ job.customer_name|join:", "|truncatewords:2 }}{% endif %}
              </div>
              {% endif %}
            </div>
            {% endfor %}
          {% endif %}
          <button 
            onclick="openCreateJobDrawer('{{ date_info.date_str }}')" 
            class="w-full mt-0.5 px-1.5 py-0.5 text-xs text-gray-500 dark:text-gray-400 hover:text-cyan-600 dark:hover:text-cyan-400 hover:bg-cyan-50 dark:hover:bg-cyan-900/20 rounded transition-colors"
          >
            + Add
          </button>
        </div>
        {% endfor %}
      </div>

      <!-- Time Slots -->
      <div class="overflow-x-auto">
        <div class="grid grid-cols-8 min-w-[800px]">
          <!-- Time Column -->
          <div class="border-r border-gray-200 dark:border-white/10">
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">6:00 AM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">7:00 AM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">8:00 AM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">9:00 AM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">10:00 AM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">11:00 AM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">12:00 PM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">1:00 PM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">2:00 PM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">3:00 PM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">4:00 PM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">5:00 PM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">6:00 PM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">7:00 PM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">8:00 PM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">9:00 PM</div>
            <div class="px-3 py-2 border-b border-gray-200 dark:border-white/10 text-xs text-gray-500 dark:text-gray-400">10:00 PM</div>
          </div>
          
          <!-- Day Columns -->
          {% for date_info in calendar_dates %}
          <div class="border-r border-gray-200 dark:border-white/10 last:border-r-0">
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
            <div class="px-1.5 py-2 border-b border-gray-200 dark:border-white/10 min-h-[50px] hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"></div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Calendar view toggle
  function toggleCalendarView(view) {
    const horizontalView = document.getElementById('calendar-horizontal-view');
    const verticalView = document.getElementById('calendar-vertical-view');
    const horizontalBtn = document.getElementById('view-toggle-horizontal');
    const verticalBtn = document.getElementById('view-toggle-vertical');
    
    if (view === 'horizontal') {
      horizontalView.classList.remove('hidden');
      verticalView.classList.add('hidden');
      horizontalBtn.classList.add('view-active', 'bg-cyan-600', 'text-white');
      horizontalBtn.classList.remove('view-inactive', 'text-gray-700', 'dark:text-gray-300');
      verticalBtn.classList.remove('view-active', 'bg-cyan-600', 'text-white');
      verticalBtn.classList.add('view-inactive', 'text-gray-700', 'dark:text-gray-300');
      localStorage.setItem('calendarView', 'horizontal');
    } else {
      horizontalView.classList.add('hidden');
      verticalView.classList.remove('hidden');
      verticalBtn.classList.add('view-active', 'bg-cyan-600', 'text-white');
      verticalBtn.classList.remove('view-inactive', 'text-gray-700', 'dark:text-gray-300');
      horizontalBtn.classList.remove('view-active', 'bg-cyan-600', 'text-white');
      horizontalBtn.classList.add('view-inactive', 'text-gray-700', 'dark:text-gray-300');
      localStorage.setItem('calendarView', 'vertical');
    }
  }
  
  // Load saved view preference
  document.addEventListener('DOMContentLoaded', function() {
    const savedView = localStorage.getItem('calendarView') || 'horizontal';
    toggleCalendarView(savedView);
  });
  function openCreateJobDrawer(dateStr) {
    // Open the drawer
    const drawer = document.getElementById('create-job');
    if (drawer) {
      drawer.showModal();
      
      // Pre-fill the dates field with the selected date
      const datesInput = document.querySelector('#create-job input[name="dates"]');
      if (datesInput) {
        // Check if there's already a date, if so add to array, otherwise create new array
        const currentValue = datesInput.value.trim();
        if (currentValue && currentValue !== '[]') {
          try {
            const dates = JSON.parse(currentValue);
            if (Array.isArray(dates) && !dates.includes(dateStr)) {
              dates.push(dateStr);
              datesInput.value = JSON.stringify(dates);
            } else if (!dates.includes(dateStr)) {
              datesInput.value = JSON.stringify([dateStr]);
            }
          } catch (e) {
            datesInput.value = JSON.stringify([dateStr]);
          }
        } else {
          datesInput.value = JSON.stringify([dateStr]);
        }
      }
    }
  }

</script>

{% endblock %}
